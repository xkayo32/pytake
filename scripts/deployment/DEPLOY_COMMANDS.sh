#!/bin/bash
# =============================================================================
# PYTAKE - FLOW AUTOMATION - COMANDOS PRONTOS PARA DEPLOY
# =============================================================================
# Copie e cole os comandos abaixo conforme necessรกrio
# =============================================================================

echo "๐ PYTAKE - FLOW AUTOMATION - DEPLOYMENT COMMANDS"
echo ""
echo "Copie e cole os comandos abaixo conforme necessรกrio"
echo ""

# =============================================================================
# FASE 1: BACKUP E PREPARAรรO
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 1: BACKUP E PREPARAรรO"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "1. Fazer backup do banco de dados:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-postgres pg_dump pytake > /tmp/pytake_backup_\$(date +%s).sql"
echo ""

# =============================================================================
# FASE 2: VERIFICAรรES PRร-DEPLOY
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 2: VERIFICAรรES PRร-DEPLOY"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "2. Verificar status dos containers:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose ps"
echo ""
echo "3. Verificar migraรงรตes pendentes:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend alembic current"
echo "podman exec pytake-backend alembic heads"
echo ""
echo "4. Verificar se migration de schedule existe:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend ls alembic/versions/ | grep -i schedule"
echo ""

# =============================================================================
# FASE 3: APLICAR MIGRATIONS
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 3: APLICAR MIGRATIONS"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "5. Aplicar migration do banco (IMPORTANTE - fazer isso primeiro!):"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend alembic upgrade head"
echo ""
echo "6. Verificar se migration foi aplicada com sucesso:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend alembic current"
echo ""

# =============================================================================
# FASE 4: INICIAR CELERY WORKERS
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 4: INICIAR CELERY WORKERS"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "7. Abrir primeiro terminal e iniciar Celery Worker:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend celery -A app.tasks.celery_app worker -l info"
echo ""
echo "8. (OPCIONAL) Em outro terminal, iniciar Celery Beat (scheduler):"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend celery -A app.tasks.celery_app beat -l info"
echo ""

# =============================================================================
# FASE 5: TESTAR BACKEND
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 5: TESTAR BACKEND"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "9. Verificar API estรก respondendo:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "curl http://localhost:8000/api/v1/docs"
echo ""
echo "10. Listar automaรงรตes existentes:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "curl -s http://localhost:8000/api/v1/flow-automations | jq"
echo ""
echo "11. Criar automaรงรฃo de teste:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo 'curl -X POST http://localhost:8000/api/v1/flow-automations \
  -H "Content-Type: application/json" \
  -d '"'"'{
    "name": "Test Automation",
    "description": "Test",
    "organization_id": "org_test",
    "chatbot_id": "chatbot_test",
    "flow_id": "flow_test",
    "whatsapp_number_id": "wa_test",
    "trigger_type": "scheduled",
    "audience_type": "all",
    "variable_mapping": {},
    "is_active": true
  }'"'"
echo ""

# =============================================================================
# FASE 6: TESTAR FRONTEND
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 6: TESTAR FRONTEND"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "12. Verificar frontend estรก respondendo:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "curl -s http://localhost:3001/admin/flow-automations | head -20"
echo ""
echo "13. Verificar build frontend:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-frontend npm run build"
echo ""

# =============================================================================
# FASE 7: VERIFICAR LOGS
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 7: VERIFICAR LOGS"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "14. Verificar logs do frontend:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose logs frontend --tail=50"
echo ""
echo "15. Verificar logs do backend:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose logs backend --tail=50"
echo ""
echo "16. Verificar logs do database:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose logs postgres --tail=50"
echo ""
echo "17. Ver logs em tempo real (todos):"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose logs -f"
echo ""

# =============================================================================
# FASE 8: TESTES MANUAIS
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 8: TESTES MANUAIS (NO BROWSER)"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "18. Abrir no navegador:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "http://localhost:3001/admin/flow-automations"
echo ""
echo "    Testes a realizar:"
echo "    โ Dashboard carrega e mostra tabela"
echo "    โ Filtros funcionam"
echo "    โ Botรฃo 'New Automation' leva ao wizard"
echo "    โ Wizard tem 4 passos"
echo "    โ Posso criar automaรงรฃo"
echo "    โ Automaรงรฃo aparece na tabela"
echo "    โ Clico em automaรงรฃo e abre detalhes"
echo "    โ 4 abas: Info, Schedule, Exceptions, History"
echo "    โ Schedule editor mostra 6 recurrence types"
echo "    โ Exceptions manager permite adicionar"
echo "    โ Dark mode toggle funciona"
echo ""

# =============================================================================
# FASE 9: TROUBLESHOOTING (SE NECESSรRIO)
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 9: TROUBLESHOOTING (SE ALGO NรO FUNCIONAR)"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "19. Se Celery nรฃo estรก conectando ao banco:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend python -c \"import sqlalchemy; print('DB OK')\""
echo ""
echo "20. Se frontend nรฃo carrega:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-frontend npm run dev"
echo ""
echo "21. Se migration falhar, reverter:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-backend alembic downgrade -1"
echo ""
echo "22. Restaurar banco do backup:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman exec pytake-postgres psql pytake < /tmp/pytake_backup_TIMESTAMP.sql"
echo ""
echo "23. Limpar cache Docker (se tudo estรก quebrado):"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose down -v"
echo "podman compose up -d"
echo ""

# =============================================================================
# FASE 10: LIMPEZA E FINALIZAรรES
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "FASE 10: LIMPEZA E FINALIZAรรES"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "24. Remover containers de teste:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose down"
echo ""
echo "25. Subir novamente em background:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "podman compose up -d"
echo ""

# =============================================================================
# RESUMO FINAL
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ RESUMO FINAL"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "Aplicaรงรตes:"
echo "  Frontend:  http://localhost:3001/admin/flow-automations"
echo "  Backend:   http://localhost:8000/api/v1/docs"
echo "  Swagger:   http://localhost:8000/api/v1/docs"
echo ""
echo "Containers:"
echo "  Backend:   pytake-backend"
echo "  Frontend:  pytake-frontend"
echo "  Database:  pytake-postgres"
echo "  Redis:     pytake-redis"
echo "  MongoDB:   pytake-mongo"
echo ""
echo "Workers:"
echo "  Celery:    celery -A app.tasks.celery_app worker -l info"
echo "  Beat:      celery -A app.tasks.celery_app beat -l info (opcional)"
echo ""

# =============================================================================
# DOCUMENTAรรO
# =============================================================================
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ DOCUMENTAรรO"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "Leia primeiro:    /home/administrator/pytake/SYSTEM_STATUS.md"
echo "รndice completo:  /home/administrator/pytake/DOCUMENTATION_INDEX.md"
echo "Checklist deploy: /home/administrator/pytake/DEPLOYMENT_CHECKLIST.md"
echo "Quick start:      /home/administrator/pytake/QUICK_START.sh"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

