# ğŸ“Š COMPARATIVO: OS 3 CAMINHOS DO HANDOFF

**Objetivo**: Visualizar lado-a-lado as 3 formas diferentes de fazer handoff de um fluxo.

---

## ğŸ¯ VISÃƒO GERAL

```
FLUXO QUALQUER
     â†“
HANDOFF NODE
     â†“
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚        â”‚        â”‚
â–¼         â–¼        â–¼        â–¼
Q      DEPT      AGENT    (default)
(Fila)  (Depto) (Direto)  (Sem handoff)


CAMINHO 1: HANDOFF â†’ QUEUE (Fila especÃ­fica)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Node Config:
{
  "handoffType": "queue",
  "queueId": "550e8400-e29b-41d4-a716-446655440000",  â† UUID da fila
  "priority": "high",
  "contextMessage": "Cliente VIP",
  "sendTransferMessage": true,
  "transferMessage": "Conectando com agente..."
}

Fluxo de ExecuÃ§Ã£o:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Extrair UUID da fila             â”‚
â”‚    queueId = "550e8400..."          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Validar UUID (try/except)        â”‚
â”‚    if UUID invÃ¡lido:                â”‚
â”‚      logger.error(), return          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Enviar msg ao cliente            â”‚
â”‚    "Conectando com agente..."       â”‚
â”‚    via Meta API ou Evolution API    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Chamar ConversationService       â”‚
â”‚    assign_to_queue_with_overflow(   â”‚
â”‚      conversation_id,               â”‚
â”‚      queue_id="550e8400...",        â”‚
â”‚      org_id                         â”‚
â”‚    )                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Check Overflow                   â”‚
â”‚    IF queue.queued >= max_size:     â”‚
â”‚      IF overflow_queue has space:   â”‚
â”‚        final_queue = overflow       â”‚
â”‚      ELSE:                          â”‚
â”‚        final_queue = original       â”‚
â”‚    ELSE:                            â”‚
â”‚      final_queue = original         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Atualizar Conversation           â”‚
â”‚    queue_id = final_queue_id        â”‚
â”‚    status = "queued"                â”‚
â”‚    queued_at = now()                â”‚
â”‚    is_bot_active = FALSE            â”‚
â”‚    queue_priority = 80              â”‚
â”‚    extra_data.handoff_context = "..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULTADO:                          â”‚
â”‚ Conversa estÃ¡ NA FILA               â”‚
â”‚ VisÃ­vel em GET /queue               â”‚
â”‚ Agentes podem puxar                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CAMINHO 2: HANDOFF â†’ DEPARTMENT (Departamento)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Node Config:
{
  "handoffType": "department",
  "departmentId": "dept-support-uuid",  â† UUID do departamento
  "priority": "normal",
  "contextMessage": "TransferÃªncia de departamento",
  "sendTransferMessage": true,
  "transferMessage": "Conectando com suporte..."
}

Fluxo de ExecuÃ§Ã£o:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Extrair UUID do departamento     â”‚
â”‚    departmentId = "dept-support..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Validar UUID (try/except)        â”‚
â”‚    if UUID invÃ¡lido:                â”‚
â”‚      logger.error(), return          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Enviar msg ao cliente            â”‚
â”‚    "Conectando com suporte..."      â”‚
â”‚    via Meta API ou Evolution API    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Buscar Primeira Fila Ativa       â”‚
â”‚    queue_repo.list_queues(          â”‚
â”‚      org_id,                        â”‚
â”‚      department_id="dept-support",  â”‚
â”‚      is_active=True,                â”‚
â”‚      limit=1  â† SÃ“ A PRIMEIRA!      â”‚
â”‚    )                                â”‚
â”‚                                     â”‚
â”‚    Resultado:                       â”‚
â”‚    [Queue(id="fila-1", ...)]        â”‚
â”‚                                     â”‚
â”‚    if queues and len > 0:           â”‚
â”‚      final_queue_id = queues[0].id  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Chamar assign_to_queue_with      â”‚
â”‚    _overflow() com final_queue_id   â”‚
â”‚    (resto Ã© igual ao CAMINHO 1)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULTADO:                          â”‚
â”‚ Conversa vai para fila principal    â”‚
â”‚ do departamento de suporte          â”‚
â”‚ (nÃ£o para fila genÃ©rica, mas a 1Âª  â”‚
â”‚  mais prioritÃ¡ria do depto)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CAMINHO 3: HANDOFF â†’ AGENT (Agente EspecÃ­fico)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Node Config:
{
  "handoffType": "agent",
  "agentId": "agent-vip-uuid",  â† UUID do agente especÃ­fico
  "priority": "urgent",
  "contextMessage": "Cliente VIP - Conectar com agente especialista",
  "sendTransferMessage": true,
  "transferMessage": "Vou conectar vocÃª com nosso especialista..."
}

Fluxo de ExecuÃ§Ã£o:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Extrair UUID do agente           â”‚
â”‚    agentId = "agent-vip-uuid"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Validar UUID (try/except)        â”‚
â”‚    if UUID invÃ¡lido:                â”‚
â”‚      logger.error(), return          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Enviar msg ao cliente            â”‚
â”‚    "Vou conectar vocÃª com nosso..." â”‚
â”‚    via Meta API ou Evolution API    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Atualizar Conversation DIRETO    â”‚
â”‚    (sem fila!)                      â”‚
â”‚                                     â”‚
â”‚    await conv_repo.update(          â”‚
â”‚      conversation.id,               â”‚
â”‚      {                              â”‚
â”‚        "is_bot_active": False,      â”‚
â”‚        "status": "active",          â”‚
â”‚        "current_agent_id": agentId, â”‚
â”‚        "queued_at": None,           â”‚
â”‚        "assigned_at": now(),        â”‚
â”‚        "queue_priority": 100        â”‚
â”‚      }                              â”‚
â”‚    )                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULTADO:                          â”‚
â”‚ Conversa atribuÃ­da DIRETAMENTE      â”‚
â”‚ ao agente (sem passar por fila)     â”‚
â”‚                                     â”‚
â”‚ Conversa imediatamente "ativa"      â”‚
â”‚ com agente especÃ­fico designado     â”‚
â”‚                                     â”‚
â”‚ Agente recebe notificaÃ§Ã£o:          â”‚
â”‚ "VocÃª tem uma conversa nova"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š COMPARAÃ‡ÃƒO LADO-A-LADO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ASPECTO            â”‚ QUEUE             â”‚ DEPARTMENT       â”‚ AGENT            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tipo de Destino    â”‚ Fila especÃ­fica  â”‚ Departamento     â”‚ Agente direto    â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Node Config Chave  â”‚ queueId          â”‚ departmentId     â”‚ agentId          â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ O que Sistema Faz  â”‚ Colocar em fila  â”‚ Busca 1Âª fila    â”‚ Atribuir direto  â”‚
â”‚                    â”‚ configurada      â”‚ ativa do depto   â”‚                  â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Conversa Entra em  â”‚ SIM              â”‚ SIM              â”‚ NÃƒO              â”‚
â”‚ Fila (Queued)?     â”‚ status="queued"  â”‚ status="queued"  â”‚ status="active"  â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Agentes Veem em    â”‚ SIM              â”‚ SIM              â”‚ NÃƒO              â”‚
â”‚ GET /queue?        â”‚ (listada)        â”‚ (listada)        â”‚ (nÃ£o aparece)    â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Precisa Pull?      â”‚ SIM              â”‚ SIM              â”‚ NÃƒO              â”‚
â”‚                    â”‚ pull_from_queue()â”‚ pull_from_queue()â”‚ (jÃ¡ atribuÃ­da)   â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Tempo de Espera    â”‚ VariÃ¡vel         â”‚ VariÃ¡vel         â”‚ Imediato         â”‚
â”‚                    â”‚ (aguarda pull)   â”‚ (aguarda pull)   â”‚ (jÃ¡ ativo)       â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Priority Usado?    â”‚ SIM              â”‚ SIM              â”‚ SIM              â”‚
â”‚ (queue_priority)   â”‚ (ordena na fila) â”‚ (ordena na fila) â”‚ (informativo)    â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Overflow Check?    â”‚ SIM              â”‚ SIM              â”‚ NÃƒO              â”‚
â”‚                    â”‚ (automÃ¡tico)     â”‚ (automÃ¡tico)     â”‚ (sem fila)       â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Caso de Uso        â”‚ Fila genÃ©rica    â”‚ Roteamento       â”‚ VIP/EscalaÃ§Ã£o    â”‚
â”‚                    â”‚ sem depto fixo   â”‚ automÃ¡tico       â”‚ para especialistaâ”‚
â”‚                    â”‚                  â”‚ por depto        â”‚                  â”‚
â”‚                    â”‚                  â”‚                  â”‚                  â”‚
â”‚ Exemplo de CÃ³digo  â”‚ handoffType:     â”‚ handoffType:     â”‚ handoffType:     â”‚
â”‚                    â”‚ "queue",         â”‚ "department",    â”‚ "agent",         â”‚
â”‚                    â”‚ queueId: "uuid1" â”‚ departmentId:    â”‚ agentId:         â”‚
â”‚                    â”‚                  â”‚ "uuid2"          â”‚ "uuid3"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ESTADO DA CONVERSA EM CADA CAMINHO

```
ANTES DO HANDOFF (todos os 3 caminhos):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ status: "active"                        â”‚
â”‚ is_bot_active: TRUE                     â”‚
â”‚ queue_id: NULL                          â”‚
â”‚ assigned_agent_id: NULL                 â”‚
â”‚ queued_at: NULL                         â”‚
â”‚ assigned_at: NULL                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â†“ HANDOFF â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMINHO 1 (QUEUE)â”‚ CAMINHO 2 (DEPT) â”‚ CAMINHO 3 (AGENT)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ status:          â”‚ status:          â”‚ status:          â”‚
â”‚   "queued"       â”‚   "queued"       â”‚   "active"       â”‚
â”‚                  â”‚                  â”‚                  â”‚
â”‚ is_bot_active:   â”‚ is_bot_active:   â”‚ is_bot_active:   â”‚
â”‚   FALSE          â”‚   FALSE          â”‚   FALSE          â”‚
â”‚                  â”‚                  â”‚                  â”‚
â”‚ queue_id:        â”‚ queue_id:        â”‚ queue_id:        â”‚
â”‚   "uuid-queue"   â”‚   "uuid-queue"   â”‚   NULL           â”‚
â”‚                  â”‚   (1Âª do depto)  â”‚                  â”‚
â”‚                  â”‚                  â”‚                  â”‚
â”‚ assigned_agent   â”‚ assigned_agent   â”‚ assigned_agent   â”‚
â”‚ _id:             â”‚ _id:             â”‚ _id:             â”‚
â”‚   NULL           â”‚   NULL           â”‚   "uuid-agent"   â”‚
â”‚                  â”‚                  â”‚                  â”‚
â”‚ queued_at:       â”‚ queued_at:       â”‚ queued_at:       â”‚
â”‚   datetime       â”‚   datetime       â”‚   NULL           â”‚
â”‚   2025-01-17T... â”‚   2025-01-17T... â”‚   (sem espera)   â”‚
â”‚                  â”‚                  â”‚                  â”‚
â”‚ assigned_at:     â”‚ assigned_at:     â”‚ assigned_at:     â”‚
â”‚   NULL           â”‚   NULL           â”‚   datetime       â”‚
â”‚   (espera pull)  â”‚   (espera pull)  â”‚   2025-01-17T... â”‚
â”‚                  â”‚                  â”‚   (imediato)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â†“ AGENTE PUXA (apenas 1 e 2) â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMINHO 1        â”‚ CAMINHO 2        â”‚ CAMINHO 3        â”‚
â”‚ (apÃ³s pull)      â”‚ (apÃ³s pull)      â”‚ (permanece)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ status:          â”‚ status:          â”‚ status:          â”‚
â”‚   "active"       â”‚   "active"       â”‚   "active"       â”‚
â”‚                  â”‚                  â”‚   (jÃ¡ estava)    â”‚
â”‚ queued_at:       â”‚ queued_at:       â”‚ queued_at:       â”‚
â”‚   NULL           â”‚   NULL           â”‚   NULL           â”‚
â”‚                  â”‚                  â”‚   (nunca teve)   â”‚
â”‚ assigned_agent   â”‚ assigned_agent   â”‚ assigned_agent   â”‚
â”‚ _id:             â”‚ _id:             â”‚ _id:             â”‚
â”‚   "uuid-agent"   â”‚   "uuid-agent"   â”‚   "uuid-agent"   â”‚
â”‚   (agora tem)    â”‚   (agora tem)    â”‚   (sempre teve)  â”‚
â”‚                  â”‚                  â”‚                  â”‚
â”‚ assigned_at:     â”‚ assigned_at:     â”‚ assigned_at:     â”‚
â”‚   datetime       â”‚   datetime       â”‚   datetime       â”‚
â”‚   (quando pull)  â”‚   (quando pull)  â”‚   (imediato)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ FLUXO DE DECISÃƒO: QUAL CAMINHO USAR?

```
VocÃª quer fazer handoff...

    â”œâ”€ ... para uma FILA GENÃ‰RICA?
    â”‚  â””â”€â†’ CAMINHO 1: handoffType="queue"
    â”‚      exemplo: "Fila de Suporte Geral"
    â”‚
    â”œâ”€ ... para um DEPARTAMENTO especÃ­fico?
    â”‚  â””â”€â†’ CAMINHO 2: handoffType="department"
    â”‚      exemplo: "Departamento de Billing"
    â”‚      (sistema busca 1Âª fila ativa do depto)
    â”‚
    â”œâ”€ ... para um AGENTE ESPECÃFICO?
    â”‚  â””â”€â†’ CAMINHO 3: handoffType="agent"
    â”‚      exemplo: "Conectar com especialista JoÃ£o"
    â”‚      (sem fila, direto)
    â”‚
    â””â”€ ... sem saber o destino antes?
       â””â”€â†’ Deixe o usuÃ¡rio escolher via outro fluxo
           (question node com opÃ§Ãµes de departamentos)
```

---

## ğŸ’¾ RESUMO: QUAL ESCOLHER?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USE CAMINHO 1 (Queue) SE:                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ VocÃª tem UUID especÃ­fico da fila                         â”‚
â”‚ âœ“ Quer que conversa aguarde agente disponÃ­vel             â”‚
â”‚ âœ“ Precisa de overflow automÃ¡tico                           â”‚
â”‚ âœ“ Quer ordenaÃ§Ã£o por priority                             â”‚
â”‚ âœ“ Quer monitoramento de SLA                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USE CAMINHO 2 (Department) SE:                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ VocÃª tem UUID do departamento (nÃ£o da fila)             â”‚
â”‚ âœ“ Sistema deve encontrar fila automaticamente              â”‚
â”‚ âœ“ Departamento tem mÃºltiplas filas por prioridade          â”‚
â”‚ âœ“ Quer deixar para o depto escolher qual fila usar        â”‚
â”‚ âœ“ NÃ£o sabe qual fila especÃ­fica ainda                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USE CAMINHO 3 (Agent) SE:                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ VocÃª tem UUID do agente especÃ­fico                       â”‚
â”‚ âœ“ Cliente Ã© VIP e precisa de agente especial               â”‚
â”‚ âœ“ Quer atribuiÃ§Ã£o IMEDIATA (sem fila)                      â”‚
â”‚ âœ“ Agente Ã© especialista e deve tomar a conversa jÃ¡         â”‚
â”‚ âœ“ NÃ£o quer conversa ficar aguardando em fila              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Comparativo completo!** ğŸ“Š
